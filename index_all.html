<!DOCTYPE html>
<html>

<head>
    <title>AI Chat</title>
    <!-- 添加 KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <!-- 添加 KaTeX JS -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <!-- 添加 auto-render 扩展，用于自动渲染页面中的数学公式 -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- 添加 highlight.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/vs2015.min.css">

    <!-- 添加 highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- 添加常用语言包 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --background-color: #f8f9fa;
            --sidebar-color: #2c3e50;
            --text-color: #2c3e50;
            --border-color: #e9ecef;
            --hover-color: #3498db;
            --message-user-bg: #e3f2fd;
            --message-ai-bg: #e8f5e9;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: var(--text-color);
            background: var(--background-color);
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 280px;
            height: 100vh;
            background: var(--sidebar-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            color: white;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 999;
            flex-shrink: 0;
            /* 防止侧边栏被压缩 */
            transition: transform 0.3s ease;
            /* 添加过渡效果 */
        }

        .sidebar.hidden {
            transform: translateX(-100%);
            /* 使用 transform 而不是 width 来隐藏 */
        }

        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 8px;
            background: var(--sidebar-color);
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            height: calc(100vh - 70px);
            /* 减去头部高度 */
        }

        .chat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.1);
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        /* 主内容区样式 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            position: relative;
            overflow: hidden;
            margin-left: 280px;
            /* 默认状态下与侧边栏宽度对应 */
            transition: margin-left 0.3s ease;
            /* 添加过渡效果 */
        }

        .main-content.with-sidebar {
            margin-left: 280px;
        }

        /* 当侧边栏隐藏时的主内容区样式 */
        .main-content.sidebar-hidden {
            margin-left: 0;
            /* 侧边栏隐藏时取消左边距 */
        }

        /* 内容区域容器 */
        .content-wrapper {
            max-width: 2000px;
            /* 从1600px增加到2000px */
            margin: 0 auto;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding-bottom: 90px;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 120px;
            /* 为输入区域留出空间 */
        }

        .chat-box {
            flex: 1;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            background: var(--background-color);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* 固定输入框区域 */
        .input-area {
            position: fixed;
            bottom: 0;
            left: 280px;
            /* 默认状态下与侧边栏宽度对应 */
            right: 0;
            padding: 20px;
            background: white;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 100;
            transition: left 0.3s ease;
            /* 添加过渡效果 */
        }

        /* 当侧边栏隐藏时的输入区域样式 */
        .sidebar-hidden .input-area {
            left: 0;
            /* 侧边栏隐藏时输入框左边界从0开始 */
        }

        #userInput {
            flex: 1;
            height: 45px;
            /* 初始一行高度 */
            min-height: 45px;
            /* 最小一行高度 */
            max-height: 450px;
            /* 最大10行高度 (45px * 10) */
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            line-height: 1.5;
            resize: none;
            overflow-y: auto;
        }

        #userInput:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .sidebar button {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 16px;
        }

        .sidebar button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .markdown-body {
            padding: 8px;
            line-height: 1.2;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 20px;
        }

        /* Markdown 列表样式 */
        .markdown-body ul,
        .markdown-body ol {
            padding-left: 1.5em;
            /* 缩进距离 */
            margin: 0em 0;
            /* 上下间距 */
        }

        .markdown-body ul li,
        .markdown-body ol li {
            margin: 0em 0;
            /* 列表项之间的间距 */
            line-height: 1.2;
            /* 列表项的行高 */
        }

        /* 无序列表的符号样式 */
        .markdown-body ul {
            list-style-type: disc;
            /* 实心圆点 */
        }

        /* 有序列表的数字样式 */
        .markdown-body ol {
            list-style-type: decimal;
            /* 数字样式 */
        }

        .markdown-body p {
            margin: 0em 0;
        }

        /* .markdown-body pre {
            background-color: #f8f9fa;
            padding: 6px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
            margin: 0.5em 0;
        } */

        /* Markdown 表格样式 */
        .markdown-body table {
            border-collapse: collapse;
            /* 合并边框 */
            width: 100%;
            /* 表格宽度为100% */
            margin: 1em 0;
            /* 上下间距 */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* 添加阴影效果 */
            border-radius: 8px;
            /* 圆角 */
            overflow: hidden;
            /* 确保圆角效果 */
        }

        .markdown-body th,
        .markdown-body td {
            border: 1px solid #ddd;
            /* 单元格边框 */
            padding: 12px;
            /* 单元格内边距 */
            text-align: left;
            /* 左对齐文本 */
        }

        .markdown-body th {
            background: #3498db;
            /* 表头背景色 */
            color: white;
            /* 表头文字颜色 */
            font-weight: bold;
            /* 表头加粗 */
        }

        .markdown-body tr:nth-child(even) {
            background: #f2f2f2;
            /* 偶数行背景色 */
        }

        .markdown-body tr:hover {
            background: #e9ecef;
            /* 鼠标悬停时的背景色 */
        }

        .markdown-body tr {
            transition: background 0.3s;
            /* 添加过渡效果 */
        }

        /* 代码块样式 */
        .markdown-body pre {
            margin: 0.5em 0;
            padding: 0.5em;
            border-radius: 6px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            overflow: auto;
            position: relative;
            padding-top: 1.8em;
        }

        .markdown-body code {
            background-color: #f8f9fa;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            border: 1px solid var(--border-color);
            white-space: pre;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 10px;
            max-width: 1600px;
            /* 从800px增加到1200px */
            position: relative;
            line-height: 1.5;
            word-wrap: break-word;
            white-space: normal;
            font-size: 20px;
            /* 固定字体大小 */
        }

        .message.user {
            background: var(--message-user-bg);
            margin-left: auto;
            border-bottom-right-radius: 4px;
            width: fit-content;
            min-width: 200px;
        }

        .message.assistant {
            background: var(--message-ai-bg);
            margin-right: auto;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            width: fit-content;
            min-width: 200px;
        }

        /* 消息标题栏样式 */
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: 8px 8px 0 0;
            margin-bottom: -1px;
        }

        /* 用户消息标题栏 */
        .message.user .message-header {
            background: #d4e9fc;
            border: 1px solid #c7e2fb;
        }

        /* AI消息标题栏 */
        .message.assistant .message-header {
            background: #dcf1dd;
            border: 1px solid #cfebd0;
        }

        /* 调整消息内容样式 */
        .message-content {
            padding: 12px 16px;
            border-radius: 0 0 10px 10px;
        }

        /* 用户消息内容 */
        .message.user .message-content {
            background: var(--message-user-bg);
        }

        /* AI消息内容 */
        .message.assistant .message-content {
            background: var(--message-ai-bg);
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* 修改搜索框样式 */
        .search-container {
            position: fixed;
            top: 10px;
            left: 60px;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .search-container.active {
            display: flex;
        }

        .search-container input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 200px;
        }

        .search-container button {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: var(--accent-color);
            color: white;
            transition: all 0.3s ease;
        }

        .search-container button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        /* 添加停止图标样式 */

        .stop-icon {

            width: 12px;

            height: 12px;

            background: white;

            border-radius: 2px;

        }

        /* 添加发送图标样式 */
        .send-icon {
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 14px solid white;
            margin-left: 4px;
        }

        /* 禁用状态样式 */
        .send-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        /* 修改侧边栏头部按钮样式 */
        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .sidebar-header button {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .sidebar-header button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* 添加固定的切换按钮样式 */
        .toggle-button {
            position: fixed;
            left: 10px;
            top: 10px;
            z-index: 1000;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--accent-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .toggle-button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        /* 搜索高亮样式 */
        .highlight {
            background-color: yellow;
            padding: 2px;
            border-radius: 2px;
        }

        /* 添加当前对话的样式 */
        .chat-item.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .chat-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 10px;
        }

        .delete-btn {
            opacity: 0;
            transition: opacity 0.2s ease;
            background: transparent;
            border: none;
            color: #ff4d4f;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }

        .chat-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: rgba(255, 59, 48, 0.2);
        }

        /* 美化滚动条 */
        .sidebar-content::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .sidebar-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* 行内公式样式 */
        .mjx-math {
            font-size: 90% !important;
        }

        /* 行间公式样式 */
        mjx-container[jax="SVG"][display="true"] {
            font-size: 90% !important;
            margin: 0.5em 0 !important;
            text-align: center;
        }

        /* 确保公式容器不会溢出 */
        mjx-container {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
        }

        /* 调整公式与文本的对齐 */
        mjx-container:not([display="true"]) {
            vertical-align: middle;
        }

        /* 特别处理行内公式的大小 */
        .message mjx-container:not([display="true"]) {
            font-size: 80% !important;
        }

        /* 调整 KaTeX 样式 */
        .katex {
            font-size: 1em !important;
        }

        .katex-display {
            margin: 0.5em 0 !important;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .katex-display>.katex {
            white-space: normal;
        }

        /* 处理长公式 */
        .katex-display>.katex>.katex-html {
            overflow-x: auto;
            overflow-y: hidden;
            padding-left: 2px;
            padding-right: 2px;
        }

        /* 当侧边栏显示时调整输入框位置 */
        .main-content.with-sidebar .input-area {
            left: calc(50% + 140px);
        }

        /* 添加提示文本样式 */
        .hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            padding-left: 20px;
        }

        /* 添加发送按钮样式 */
        .send-button {
            width: 45px;
            /* 与输入框高度一致 */
            height: 45px;
            /* 与输入框高度一致 */
            border: none;
            border-radius: 8px;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            /* 添加这行以改善文字垂直对齐 */
            padding: 0;
            /* 移除内边距以确保完全居中 */
        }

        .button-icon {
            font-size: 24px;
            display: flex;
            /* 添加这行 */
            align-items: center;
            /* 添加这行 */
            justify-content: center;
            /* 添加这行 */
            width: 100%;
            /* 添加这行 */
            height: 100%;
            /* 添加这行 */
            transition: all 0.3s ease;
        }


        /* 代码块标题栏样式 */
        .code-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1.3em;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            font-size: 0.9em;
            color: #495057;
            border-radius: 5px 5px 0 0;
        }

        /* 语言标题样式 */
        .code-language {
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            color: #495057;
        }

        /* 复制按钮样式 */
        .copy-button {
            position: absolute;
            /* 绝对定位 */
            top: 10px;
            /* 距离顶部10px */
            right: 10px;
            /* 距离右侧10px */
            background: rgba(52, 152, 219, 0.8);
            /* 按钮背景色 */
            color: white;
            /* 按钮文字颜色 */
            border: none;
            /* 无边框 */
            border-radius: 4px;
            /* 圆角 */
            padding: 5px 10px;
            /* 内边距 */
            cursor: pointer;
            /* 鼠标指针样式 */
            font-size: 0.9em;
            /* 字体大小 */
            transition: background 0.3s;
            /* 添加过渡效果 */
        }

        .copy-button:hover {
            color: var(--accent-color);
        }

        /* 复制成功提示样式 */
        .copy-button.copied {
            color: #28a745;
        }

        /* 代码块基础样式 - GitHub 风格的浅灰色背景
         * 用于所有代码块的背景色和基本文本颜色
         * 包括行内代码和多行代码块
         */
        .hljs {
            background: #f6f8fa !important;
            color: #24292e !important;
        }

        /* 关键字 - GitHub 风格的红色
         * 用于语言关键字和控制流语句
         * 例如: if, else, return, class, import
         */
        .hljs-keyword {
            color: #d73a49 !important;
        }

        /* 字符串 - GitHub 风格的蓝色
         * 用于字符串字面量
         * 例如: "hello", 'world', `template`
         */
        .hljs-string {
            color: #032f62 !important;
        }

        /* 注释 - GitHub 风格的灰色
         * 用于单行和多行注释
         * 例如: // 注释, /* 多行注释 */
        */ .hljs-comment {
            color: #57606a !important;
            font-style: italic !important;
        }


        /* 变量名 - GitHub 风格的深色
         * 用于变量引用和声明
         * 例如: myVariable, counter, i
         */
        .hljs-variable {
            color: #24292e !important;
        }

        /* 运算符 - GitHub 风格的深色
         * 用于算术、逻辑和其他运算符
         * 例如: +, -, *, /, =, ==, !=, &&
         */
        .hljs-operator {
            color: #24292e !important;
        }

        /* 标点符号 - GitHub 风格的深色
         * 用于分隔符和标点
         * 例如: (, ), {, }, [, ], ;, :
         */
        .hljs-punctuation {
            color: #24292e !important;
        }

        /* 正则表达式 - GitHub 风格的蓝色
         * 用于正则表达式字面量
         * 例如: /\w+/, /[a-z]+/gi
         */
        .hljs-regexp {
            color: #032f62 !important;
        }

        /* 属性名 - GitHub 风格的深蓝色
         * 用于对象属性和HTML属性
         * 例如: object.property, <div class="...">
         */
        .hljs-attr {
            color: #005cc5 !important;
        }

        /* HTML/XML标签 - GitHub 风格的绿色
         * 用于标记语言的标签
         * 例如: <div>, <span>, <p>
         */
        .hljs-tag {
            color: #22863a !important;
        }

        /* 函数参数 - GitHub 风格的深色
         * 用于函数参数列表中的参数名
         * 例如: function(param1, param2)
         */
        .hljs-params {
            color: #24292e !important;
        }

        /* 文档标记 - GitHub 风格的灰色
         * 用于文档注释中的特殊标记
         * 例如: @param, @return, @throws
         */
        .hljs-doctag {
            color: #6a737d !important;
            font-style: italic !important;
        }

        /* 元信息 - GitHub 风格的蓝色
         * 用于预处理指令和元数据标记
         * 例如: #include, #define, @decorator
         */
        .hljs-meta {
            color: #005cc5 !important;
        }

        /* 函数相关样式 - GitHub风格的紫色
         * 用于函数声明和定义的整体样式
         * 例如: function myFunction(), def my_function():
         */
        .hljs-function {
            color: #8250df !important;
        }

        /* 标题/名称样式 - GitHub风格的紫色
         * 用于各种标识符的名称
         * 包括函数名、类名等
         */
        .hljs-title {
            color: #8250df !important;
        }

        /* 类名样式 - GitHub风格的紫色
         * 专门用于类的声明和定义
         * 例如: class MyClass, class Solution
         */
        .hljs-title.class_ {
            color: #8250df !important;
        }

        /* 类型声明样式 - GitHub风格的红色
         * 用于类型声明和类型注解
         * 例如: int, string, boolean, void
         */
        .hljs-type {
            color: #cf222e !important;
        }


        /* 行内代码样式保持不变 */
        #preview :not(pre)>code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 4px;
            color: #e83e8c;
        }

        /* 表格样式 */
        #preview table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        #preview th,
        #preview td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #preview th {
            background: #f8f9fa;
        }


        /* 函数名称 - 使用 GitHub 风格的深紫色
         * 用于函数声明和调用时的函数名
         * 例如: function calculate(), myFunction() 
         */
        .hljs-title.function_ {
            color: #6f42c1 !important;
        }

        /* 函数名称（另一种选择器）- 保持与上面相同的深紫色
         * 用于确保不同语言中的函数名都能正确显示
         * 例如: def my_function():, void myFunction() 
         */
        .hljs-function .hljs-title {
            color: #6f42c1 !important;
        }

        /* 类型名称 - GitHub 风格的红色
         * 用于类型声明和类型注解
         * 例如: int, string, void, Vector<T> 
         */
        .hljs-type {
            color: #d73a49 !important;
        }

        /* 内置类型/函数 - GitHub 风格的红色
         * 用于语言内置的类型和函数
         * 例如: string, int32, len(), sizeof() 
         */
        .hljs-built_in {
            color: #d73a49 !important;
        }

        /* 数字字面量 - GitHub 风格的深蓝色
         * 用于所有数字常量
         * 例如: 42, 3.14, 0xFF 
         */
        .hljs-number {
            color: #005cc5 !important;
        }

        /* 字符串插值中的表达式 - 深灰色
         * 用于字符串模板中的变量和表达式
         * 例如: `${variable}`, f"{value}" 
         */
        .hljs-subst {
            color: #24292e !important;
        }

        /* 模板变量 - 深灰色
         * 用于各种模板语言中的变量
         * 例如: ${variable}, #{variable}, @{variable} 
         */
        .hljs-template-variable {
            color: #24292e !important;
        }

        /* 行内代码样式
        .markdown-body :not(pre) > code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 4px;
            color: #e83e8c;
            border: 1px solid #e9ecef;
        } */
    </style>

    <script>
        // 添加在其他脚本的最前面
        // 阻止浏览器默认的 Ctrl + 滚轮缩放行为
        document.addEventListener('wheel', function (e) {
            if (e.ctrlKey) {
                e.preventDefault();
            }
        }, { passive: false });

        // 配置 marked 以处理数学公式
        marked.setOptions({
            breaks: true,
            gfm: true,
            pedantic: false,
            sanitize: false,
            smartLists: true,
            smartypants: false
        });

        // 创建一个自定义渲染器来处理数学公式
        const renderer = new marked.Renderer();
        const originalParagraph = renderer.paragraph.bind(renderer);
        renderer.paragraph = (text) => {
            return originalParagraph(text);
        };
        marked.setOptions({ renderer });
    </script>
</head>

<body>
    <!-- 添加固定的切换按钮 -->
    <button class="toggle-button" onclick="toggleSidebar()">≡</button>

    <!-- 搜索框 -->
    <div class="search-container" id="searchContainer">
        <input type="text" id="searchInput" placeholder="搜索...">
        <button onclick="performSearch()">🔍</button>
        <button onclick="closeSearch()">✕</button>
    </div>

    <!-- 侧边栏 -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button onclick="showSearch()">🔍</button>
            <button onclick="startNewChat()">+</button>
        </div>
        <div class="sidebar-content" id="chatHistory"></div>
    </div>

    <!-- 主内容区 -->
    <div class="main-content" id="mainContent">
        <div class="content-wrapper">
            <div class="chat-container">
                <div id="chatBox" class="chat-box"></div>
            </div>
            <div class="input-area">
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <textarea id="userInput" placeholder="输入问题... (Shift + Enter 换行，Enter 发送)" rows="1"></textarea>
                    <button id="sendButton" class="send-button">
                        <span class="button-icon">▶</span>
                    </button>
                </div>
                <div class="hint">提示：使用 Shift + Enter 换行，Enter 发送</div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'sk-h7h4505fa57c4316b50bbb9784a454dh';  // 直接指定API密钥
        const BASE_URL = 'https://api.deepseek.com';

        marked.setOptions({
            highlight: function (code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, {
                            language: lang,
                            ignoreIllegals: true
                        }).value;
                    } catch (e) {
                        console.error(e);
                    }
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,
            gfm: true
        });

        let messages = [{
            "role": "system",
            "content": `You are an AI expert, answer in Chinese and markdown format. Follow these formatting rules:
1. Use proper indentation for code blocks
2. Break long paragraphs into shorter ones for better readability
3. Add line breaks after every main point
4. When showing code, always specify the language after triple backticks
5. Keep lines under 80 characters when possible
6. Use proper markdown formatting for lists and headings
7. For mathematical formulas:
   - Use single $ for inline math expressions (e.g., $E=mc^2$)
   - Use double $$ for block math expressions (e.g., $$\\sum_{i=1}^n i = \\frac{n(n+1)}{2}$$)
   - Always use proper LaTeX syntax for math expressions`
        }];

        let isNewChat = true;  // 添加标记来判断是否是新对话

        let currentChatIndex = null;  // 添加当前对话索引标记

        // 添加发送按钮相关的变量和函数
        let controller;  // 确保 controller 是全局变量
        let isGenerating = false;  // 确保 isGenerating 是全局变量
        const sendButton = document.getElementById('sendButton');

        function setSendButtonToStop() {
            const sendButton = document.getElementById('sendButton');
            sendButton.classList.add('sending');
            sendButton.querySelector('.button-icon').innerHTML = '<div class="stop-icon"></div>';  // 使用方块图标
            isGenerating = true;  // 设置为正在生成
        }

        function resetSendButton() {
            const sendButton = document.getElementById('sendButton');
            sendButton.classList.remove('sending');
            sendButton.querySelector('.button-icon').innerHTML = '▶';  // 恢复为三角形图标
            isGenerating = false;  // 设置为不在生成
        }

        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const text = userInput.value.trim();
            if (!text) return;

            // 清除欢迎消息
            if (isNewChat) {
                document.getElementById('chatBox').innerHTML = '';
            }

            appendMessage('user', text);
            userInput.value = '';
            messages.push({ "role": "user", "content": text });

            // 重置输入框高度
            userInput.style.height = 'auto';  // 先设置为 auto，以便计算高度
            userInput.style.height = `${userInput.scrollHeight}px`;  // 设置为当前内容的高度

            try {
                controller = new AbortController();  // 创建新的 AbortController
                setSendButtonToStop();  // 设置按钮为停止状态

                const response = await fetch(`${BASE_URL}/v1/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 8000,
                        stream: true,
                    }),
                    signal: controller.signal  // 将信号传递给 fetch
                });

                const chatBox = document.getElementById('chatBox');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message assistant';

                // 创建标题栏
                const headerDiv = document.createElement('div');
                headerDiv.className = 'message-header';
                const titleSpan = document.createElement('span');
                titleSpan.textContent = 'AI';
                headerDiv.appendChild(titleSpan);

                // 添加复制按钮
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-button';
                copyButton.textContent = '复制';
                copyButton.onclick = async () => {
                    try {
                        await navigator.clipboard.writeText(fullResponse);
                        copyButton.textContent = '已复制!';
                        setTimeout(() => {
                            copyButton.textContent = '复制';
                        }, 2000);
                    } catch (err) {
                        console.error('复制失败:', err);
                    }
                };
                headerDiv.appendChild(copyButton);

                // 创建内容区域
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content markdown-body';

                // 组装消息结构
                messageDiv.appendChild(headerDiv);
                messageDiv.appendChild(contentDiv);
                chatBox.appendChild(messageDiv);

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                // 在开始流式处理前添加空的助手消息
                messages.push({ "role": "assistant", "content": "" });

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ') && line !== 'data: [DONE]') {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.choices[0].delta.content) {
                                    const content = data.choices[0].delta.content;
                                    fullResponse += content;

                                    // 处理数学公式和 Markdown
                                    const mathExpressions = [];
                                    let processedContent = fullResponse.replace(/\$\$(.*?)\$\$|\$(.*?)\$/gs, (match, block, inline) => {
                                        const id = mathExpressions.length;
                                        mathExpressions.push({
                                            type: match.startsWith('$$') ? 'block' : 'inline',
                                            content: block || inline
                                        });
                                        return `%%MATH_${id}%%`;
                                    });

                                    processedContent = marked.parse(processedContent);

                                    processedContent = processedContent.replace(/%%MATH_(\d+)%%/g, (match, id) => {
                                        const expr = mathExpressions[parseInt(id)];
                                        return expr.type === 'block'
                                            ? `\\[${expr.content}\\]`
                                            : `\\(${expr.content}\\)`;
                                    });

                                    contentDiv.innerHTML = processedContent;

                                    // 渲染数学公式
                                    renderMathInElement(contentDiv, {
                                        delimiters: [
                                            { left: "\\[", right: "\\]", display: true },
                                            { left: "\\(", right: "\\)", display: false }
                                        ],
                                        throwOnError: false,
                                        output: 'html',
                                        strict: false
                                    });

                                    // 确保所有代码块都被高亮
                                    contentDiv.querySelectorAll('pre code').forEach((block) => {
                                        hljs.highlightBlock(block);
                                        // 获取语言类
                                        const languageClass = block.className.match(/language-(\w+)/) || [null, 'plaintext'];
                                        const language = languageClass[1];
                                        // 添加标题栏和复制按钮
                                        createCodeHeader(block, language);
                                    });

                                    // 确保滚动到底部
                                    scrollToBottom();

                                    // 更新最后一条消息的内容
                                    messages[messages.length - 1].content = fullResponse;
                                }
                            } catch (e) {
                                console.error('Error parsing chunk:', e);
                            }
                        }
                    }
                }

                if (isNewChat) {
                    // 修改这里使用 text 而不是 userInput
                    saveToLocalStorage(text, fullResponse, [...messages]);
                    isNewChat = false;
                } else if (currentChatIndex !== null) {
                    // 更新现有对话
                    const chats = JSON.parse(localStorage.getItem('chats') || '[]');
                    if (chats[currentChatIndex]) {
                        chats[currentChatIndex].messages = [...messages];
                        localStorage.setItem('chats', JSON.stringify(chats));
                    }
                }

            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('Response generation was stopped');
                } else {
                    console.error('Error:', error);
                    appendMessage('system', '发生错误，请重试');
                }
            } finally {
                resetSendButton();  // 重置按钮状态
                controller = null;  // 清空 controller
            }
        }

        function appendMessage(role, content) {
            const chatBox = document.getElementById('chatBox');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;

            // 创建标题栏
            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';

            // 添加角色标题
            const titleSpan = document.createElement('span');
            titleSpan.textContent = role === 'user' ? '用户' : 'AI';
            headerDiv.appendChild(titleSpan);

            // 添加复制按钮
            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.textContent = '复制';
            copyButton.onclick = async () => {
                try {
                    await navigator.clipboard.writeText(content);
                    copyButton.textContent = '已复制!';
                    setTimeout(() => {
                        copyButton.textContent = '复制';
                    }, 2000);
                } catch (err) {
                    console.error('复制失败:', err);
                }
            };
            headerDiv.appendChild(copyButton);

            // 创建内容区域
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            if (role === 'user') {
                // 用户消息保持原始格式
                contentDiv.innerHTML = content.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;');
            } else {
                // AI消息使用markdown渲染
                contentDiv.className += ' markdown-body';

                // 先将数学公式部分提取出来，用占位符替代
                const mathExpressions = [];
                let processedContent = content.replace(/\$\$(.*?)\$\$|\$(.*?)\$/gs, (match, block, inline) => {
                    const id = mathExpressions.length;
                    mathExpressions.push({
                        type: match.startsWith('$$') ? 'block' : 'inline',
                        content: block || inline
                    });
                    return `%%MATH_${id}%%`;
                });

                // 渲染 Markdown
                processedContent = marked.parse(processedContent);

                // 还原数学公式
                processedContent = processedContent.replace(/%%MATH_(\d+)%%/g, (match, id) => {
                    const expr = mathExpressions[parseInt(id)];
                    return expr.type === 'block'
                        ? `\\[${expr.content}\\]`
                        : `\\(${expr.content}\\)`;
                });

                contentDiv.innerHTML = `<div class="markdown-body">${processedContent}</div>`;

                // 渲染数学公式
                renderMathInElement(contentDiv, {
                    delimiters: [
                        { left: "\\[", right: "\\]", display: true },
                        { left: "\\(", right: "\\)", display: false }
                    ],
                    throwOnError: false,
                    output: 'html',
                    strict: false
                });

                // 处理代码高亮等
                contentDiv.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightBlock(block);
                    // 获取语言类
                    const languageClass = block.className.match(/language-(\w+)/) || [null, 'plaintext'];
                    const language = languageClass[1];
                    // 添加标题栏和复制按钮
                    createCodeHeader(block, language);
                });
            }

            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            chatBox.appendChild(messageDiv);
            scrollToBottom();
        }

        function saveToLocalStorage(question, answer, allMessages) {
            const timestamp = new Date().toISOString();
            const chat = {
                timestamp,
                question,
                answer,
                messages: allMessages,
                title: generateChatTitle(question, answer)
            };

            let chats = JSON.parse(localStorage.getItem('chats') || '[]');
            chats.push(chat);
            currentChatIndex = chats.length - 1;  // 设置当前对话索引
            localStorage.setItem('chats', JSON.stringify(chats));
            updateChatHistory();
        }

        function generateChatTitle(question, answer) {
            // 使用问题的前20个字符作为标题
            return question.slice(0, 20) + (question.length > 20 ? '...' : '');
        }

        function updateChatHistory() {
            const historyDiv = document.getElementById('chatHistory');
            const chats = JSON.parse(localStorage.getItem('chats') || '[]');

            historyDiv.innerHTML = '';
            chats.reverse().forEach((chat, index) => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                if (currentChatIndex === (chats.length - 1 - index)) {
                    chatItem.classList.add('active');
                }

                // 添加标题容器
                const titleDiv = document.createElement('div');
                titleDiv.className = 'chat-title';
                titleDiv.textContent = chat.title;
                titleDiv.onclick = () => loadChat(chats.length - 1 - index);

                // 添加删除按钮
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '✕';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();  // 阻止事件冒泡
                    deleteChat(chats.length - 1 - index);
                };

                chatItem.appendChild(titleDiv);
                chatItem.appendChild(deleteBtn);
                historyDiv.appendChild(chatItem);
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');

            sidebar.classList.toggle('hidden');
            mainContent.classList.toggle('sidebar-hidden');
        }

        let isSearchActive = false;
        let currentSearchTerm = '';

        function showSearch() {
            const searchContainer = document.getElementById('searchContainer');
            searchContainer.classList.add('active');
            document.getElementById('searchInput').focus();
        }

        function closeSearch() {
            const searchContainer = document.getElementById('searchContainer');
            searchContainer.classList.remove('active');
            document.getElementById('searchInput').value = '';
            isSearchActive = false;
            currentSearchTerm = '';
            updateChatHistory();  // 恢复显示所有历史记录
        }

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!searchTerm) return;

            isSearchActive = true;
            currentSearchTerm = searchTerm;
            const chats = JSON.parse(localStorage.getItem('chats') || '[]');

            // 在标题和内容中搜索
            const results = chats.filter(chat =>
                chat.question.toLowerCase().includes(searchTerm) ||
                chat.answer.toLowerCase().includes(searchTerm)
            );

            const historyDiv = document.getElementById('chatHistory');
            historyDiv.innerHTML = '';

            // 显示搜索结果
            results.reverse().forEach((chat, index) => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';

                // 高亮显示匹配的文本
                let title = generateChatTitle(chat.question, chat.answer);
                if (title.toLowerCase().includes(searchTerm)) {
                    title = title.replace(new RegExp(searchTerm, 'gi'),
                        match => `<span class="highlight">${match}</span>`);
                }

                chatItem.innerHTML = title;

                // 使用原始索引加载正确的对话
                const originalIndex = chats.findIndex(c =>
                    c.timestamp === chat.timestamp &&
                    c.question === chat.question
                );

                chatItem.onclick = () => {
                    loadChat(originalIndex);
                    // 在加载的对话内容中也高亮显示搜索词
                    highlightSearchInChat(searchTerm);
                };

                historyDiv.appendChild(chatItem);
            });
        }

        // 在对话内容中高亮显示搜索词
        function highlightSearchInChat(searchTerm) {
            const chatBox = document.getElementById('chatBox');
            const messages = chatBox.getElementsByClassName('message');

            Array.from(messages).forEach(message => {
                const content = message.innerHTML;
                message.innerHTML = content.replace(new RegExp(searchTerm, 'gi'),
                    match => `<span class="highlight">${match}</span>`);
            });
        }

        function startNewChat() {
            messages = [{
                "role": "system",
                "content": `You are an AI expert, answer in Chinese and markdown format. Follow these formatting rules:
1. Use proper indentation for code blocks
2. Break long paragraphs into shorter ones for better readability
3. Add line breaks after every main point
4. When showing code, always specify the language after triple backticks
5. Keep lines under 80 characters when possible
6. Use proper markdown formatting for lists and headings
7. For mathematical formulas:
   - Use single $ for inline math expressions (e.g., $E=mc^2$)
   - Use double $$ for block math expressions (e.g., $$\\sum_{i=1}^n i = \\frac{n(n+1)}{2}$$)
   - Always use proper LaTeX syntax for math expressions`
            }];

            document.getElementById('chatBox').innerHTML = '';

            // 添加欢迎消息
            const welcomeMessage = `## 👋 欢迎使用 AI 助手！

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0;">
  <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; border: 1px solid #e9ecef;">
    <h4 style="margin: 0 0 4px 0;">🔍 解答问题</h4>
    <div style="font-size: 0.9em; line-height: 1.3;">
    技术咨询 • 概念解释 • 方案建议
    </div>
  </div>
  <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; border: 1px solid #e9ecef;">
    <h4 style="margin: 0 0 4px 0;">💻 编程辅助</h4>
    <div style="font-size: 0.9em; line-height: 1.3;">
    代码审查 • 算法设计 • 调试帮助
    </div>
  </div>
  <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; border: 1px solid #e9ecef;">
    <h4 style="margin: 0 0 4px 0;">📝 文档协作</h4>
    <div style="font-size: 0.9em; line-height: 1.3;">
    文档编写 • API生成 • 注释优化
    </div>
  </div>
  <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; border: 1px solid #e9ecef;">
    <h4 style="margin: 0 0 4px 0;">🎯 项目支持</h4>
    <div style="font-size: 0.9em; line-height: 1.3;">
    架构设计 • 性能优化 • 安全建议
    </div>
  </div>
</div>`;

            appendMessage('assistant', welcomeMessage);
            isNewChat = true;
            currentChatIndex = null;
            updateChatHistory();
        }

        function loadChat(index) {
            const chats = JSON.parse(localStorage.getItem('chats') || '[]');
            const chat = chats[index];
            if (chat && chat.messages) {
                currentChatIndex = index;  // 设置当前对话索引
                document.getElementById('chatBox').innerHTML = '';

                // 加载所有消息
                messages = [...chat.messages];

                // 显示所有消息
                chat.messages.forEach(msg => {
                    if (msg.role !== 'system') {
                        appendMessage(msg.role, msg.content);
                    }
                });

                isNewChat = false;
            }
        }

        window.onload = function () {
            updateChatHistory();
        };

        const input = document.getElementById('userInput');

        // 添加自动调整高度的函数
        function adjustInputHeight() {
            const input = document.getElementById('userInput');
            const lineHeight = parseInt(window.getComputedStyle(input).lineHeight);
            // 计算当前文本的行数
            const lines = input.value.split('\n');
            // 设置最大行数为10
            const maxRows = 10;
            const rows = Math.min(lines.length, maxRows);
            // 设置高度
            input.style.height = (rows * lineHeight) + 'px';
        }

        // 添加输入事件监听，以便在任何输入时调整高度
        document.getElementById('userInput').addEventListener('input', function () {
            adjustInputHeight(this);
        });

        // 监听键盘事件
        document.getElementById('userInput').addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                if (e.shiftKey) {
                    // Shift + Enter: 换行并调整高度
                    setTimeout(() => adjustInputHeight(this), 0);
                }
            }
        });

        // 修改事件监听和处理逻辑
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('userInput');

            // 只保留发送消息的功能
            input.addEventListener('keydown', async function (e) {
                if (e.key === 'Enter') {
                    if (e.shiftKey) {
                        // Shift + Enter: 换行
                        return;
                    } else {
                        // Enter: 发送
                        e.preventDefault();
                        const text = input.value.trim();
                        if (text) {
                            await sendMessage();
                        }
                    }
                }
            });
        });

        // 添加删除对话的函数
        function deleteChat(index) {
            if (confirm('确定要删除这个对话吗？')) {
                let chats = JSON.parse(localStorage.getItem('chats') || '[]');
                chats.splice(index, 1);
                localStorage.setItem('chats', JSON.stringify(chats));

                // 如果删除的是当前对话，清空聊天框并重置状态
                if (currentChatIndex === index) {
                    startNewChat();
                } else if (currentChatIndex > index) {
                    // 如果删除的是当前对话之前的对话，需要调整currentChatIndex
                    currentChatIndex--;
                }

                updateChatHistory();
            }
        }

        // 添加滚动到底部的函数
        function scrollToBottom() {
            const chatBox = document.getElementById('chatBox');
            const chatContainer = document.querySelector('.chat-container');

            // 使用 requestAnimationFrame 确保在下一帧渲染时滚动
            requestAnimationFrame(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        // 移除所有与侧边栏缩放相关的事件监听
        document.addEventListener('DOMContentLoaded', function () {
            // 阻止侧边栏的滚轮缩放
            const sidebar = document.querySelector('.sidebar');
            sidebar.addEventListener('wheel', function (e) {
                if (e.ctrlKey) {
                    e.preventDefault();
                }
            }, { passive: false });

            // 阻止侧边栏内容的滚轮缩放
            const sidebarContent = document.querySelector('.sidebar-content');
            sidebarContent.addEventListener('wheel', function (e) {
                if (e.ctrlKey) {
                    e.preventDefault();
                }
            }, { passive: false });
        });

        // 添加按钮点击事件
        sendButton.addEventListener('click', function () {
            if (isGenerating) {
                // 如果正在生成，则停止
                controller.abort();  // 中止请求
                resetSendButton();  // 重置按钮状态
            } else {
                // 如果不在生成，则发送消息
                sendMessage();
            }
        });

        // 修改输入框事件监听
        userInput.addEventListener('input', function () {
            // 当输入框有内容时启用按钮
            if (this.value.trim()) {
                sendButton.style.opacity = '1';
                sendButton.style.cursor = 'pointer';
            } else {
                sendButton.style.opacity = '0.5';
                sendButton.style.cursor = 'default';
            }
        });

        function createCodeHeader(codeBlock, language) {
            const header = document.createElement('div');
            header.className = 'code-header';

            // 添加语言标题
            const languageSpan = document.createElement('span');
            languageSpan.className = 'code-language';
            languageSpan.textContent = language || 'plaintext';

            // 添加复制按钮
            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.innerHTML = '复制';
            copyButton.onclick = async () => {
                try {
                    await navigator.clipboard.writeText(codeBlock.textContent);
                    copyButton.innerHTML = '已复制!';
                    copyButton.classList.add('copied');
                    setTimeout(() => {
                        copyButton.innerHTML = '复制';
                        copyButton.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('复制失败:', err);
                }
            };

            header.appendChild(languageSpan);
            header.appendChild(copyButton);

            // 将header插入到pre元素的最前面
            const preElement = codeBlock.parentElement;
            preElement.insertBefore(header, preElement.firstChild);
        }
    </script>
</body>

</html>